spring:
  main:
    web-application-type: none

zrivot:
  max-concurrent-api-requests: 50  # global limit per task manager across all enrichers
  pipeline:
    mode: REALTIME  # REALTIME or OFFLINE
  kafka:
    bootstrap-servers: localhost:9092
    raw-topic: raw-purchases
    output-topic: enriched-purchases
  elasticsearch:
    hosts:
      - http://localhost:9200
    index: purchases
    username: ""
    password: ""
    connect-timeout-ms: 5000
    socket-timeout-ms: 30000
  joiner:
    timeout-ms: 30000
  reflow:
    slice-threshold: 10000
    max-slices: 10
    fetch-batch-size: 1000
    sort-field: startTime  # sort by this field DESC then _id ASC; omit for _id-only sort
  enrichers:
    - name: purchase-geo-enricher
      consumer-group: purchase-geo-enricher-group       # not required in OFFLINE mode
      reflow-enabled: true
      reflow-topic: reflow-purchase-geo
      reflow-consumer-group: reflow-purchase-geo-group
      class-name: com.zrivot.purchases.enrichment.PurchaseGeoEnricher
      bulk-enabled: false
      bulk-size: 10
      rate-limit-per-second: 50     # max 50 API requests/sec per operator instance
      retry-delay-ms: 5000
      max-retries: 3
      properties:
        apiUrl: http://geo-service:8080/enrich
        bulkApiUrl: http://geo-service:8080/enrich/bulk
        timeoutMs: "5000"
    - name: purchase-fraud-enricher
      consumer-group: purchase-fraud-enricher-group       # not required in OFFLINE mode
      reflow-enabled: false
      class-name: com.zrivot.enrichment.ApiEnricher
      bulk-enabled: true
      bulk-size: 20
      rate-limit-per-second: 20     # max 20 bulk requests/sec per operator instance
      retry-delay-ms: 5000
      max-retries: 3
      properties:
        apiUrl: http://fraud-service:8080/enrich
        bulkApiUrl: http://fraud-service:8080/enrich/bulk
        timeoutMs: "5000"
